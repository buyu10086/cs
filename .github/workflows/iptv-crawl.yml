# name: 自动抓取IPTV源并生成m3u8
name: 自动抓取IPTV源并生成m3u8

# 定时触发：每天早上5点、下午5点各一次（适配北京时间，已做UTC时区换算）
# 也可以手动触发（workflow_dispatch）
on:
  schedule:
    - cron: '0 21 * * *'  # UTC时间21点 = 北京时间次日5点（早上5点）
    - cron: '0 9 * * *'   # UTC时间9点 = 北京时间17点（下午5点）
  workflow_dispatch:  # 保留手动触发按钮

# 运行环境和步骤（这部分完全不变）
jobs:
  crawl-iptv:
    runs-on: ubuntu-latest  # 使用Ubuntu系统运行
    
    steps:
      # 1. 拉取仓库代码到运行环境
      - name: 拉取仓库代码
        uses: actions/checkout@v4
      
      # 2. 设置Python环境
      - name: 设置Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'  # Python版本
      
      # 3. 安装依赖（requests库）
      - name: 安装依赖包
        run: |
          python -m pip install --upgrade pip
          pip install requests
      
      # 4. 运行抓取脚本
      - name: 执行IPTV抓取脚本
        run: python iptv_crawler.py
      
      # 5. 自动提交生成的m3u8文件到仓库
      - name: 提交更新后的m3u8文件
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add iptv_playlist.m3u8
          # 只有文件变化时才提交，避免空提交
          git diff --quiet && git diff --staged --quiet || (git commit -m "Auto update IPTV m3u8 file $(date +'%Y-%m-%d %H:%M:%S')" && git push)
